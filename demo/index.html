<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸµ é«˜é¢œå€¼éŸ³ä¹æ’­æ”¾å™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'PingFang SC', sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .player-container {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      width: 100%;
      max-width: 500px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .title {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.8em;
      font-weight: bold;
    }

    /* é¢‘è°±åŒºåŸŸ */
    .visualizer {
      height: 150px;
      margin: 20px 0;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      gap: 2px;
    }

    .visualizer-bar {
      width: 4px;
      background: linear-gradient(to top, #ff5e62, #ff9966);
      border-radius: 2px 2px 0 0;
      transition: height 0.1s ease;
    }

    /* æ­Œè¯åŒºåŸŸ */
    .lyrics-container {
      height: 180px;
      overflow: hidden;
      margin: 20px 0;
      text-align: center;
      position: relative;
    }

    .lyrics {
      position: absolute;
      width: 100%;
      transition: transform 0.5s ease;
    }

    .lyric-line {
      padding: 8px 0;
      opacity: 0.6;
      transition: all 0.3s ease;
    }

    .lyric-line.active {
      opacity: 1;
      font-size: 1.2em;
      font-weight: bold;
      color: #ffcc00;
    }

    /* æ§åˆ¶æ  */
    .controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 20px 0;
    }

    .btn {
      background: none;
      border: none;
      color: white;
      font-size: 1.5em;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn:hover {
      transform: scale(1.2);
    }

    .progress-container {
      background: rgba(255, 255, 255, 0.2);
      height: 6px;
      border-radius: 3px;
      cursor: pointer;
      margin: 10px 0;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(to right, #ff5e62, #ff9966);
      border-radius: 3px;
      position: relative;
    }

    .time-info {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      opacity: 0.8;
    }

    audio {
      width: 100%;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <div class="player-container">
    <h2 class="title">ğŸ§ éŸ³ä¹æ’­æ”¾å™¨</h2>

    <!-- é¢‘è°±å¯è§†åŒ– -->
    <div class="visualizer" id="visualizer"></div>

    <!-- æ­Œè¯ -->
    <div class="lyrics-container">
      <div class="lyrics" id="lyrics"></div>
    </div>

    <!-- è¿›åº¦æ¡ -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="time-info">
      <span id="currentTime">0:00</span>
      <span id="duration">0:00</span>
    </div>

    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="controls">
      <button class="btn" id="prevBtn">â®ï¸</button>
      <button class="btn" id="playBtn">â–¶ï¸</button>
      <button class="btn" id="nextBtn">â­ï¸</button>
    </div>

    <!-- éšè—çš„ audio å…ƒç´  -->
    <audio id="audio" preload="metadata"></audio>
  </div>

  <script>
    // ===== æ•°æ®éƒ¨åˆ†ï¼ˆå¯æ›¿æ¢ä¸ºçœŸå®æ­Œæ›²ï¼‰=====
    const songs = [
      {
        src: "/songs/Foolâ€™s Garden,Fool's Garden - Lemon Tree.mp3",
        title: 'Lemon Tree',
        lyrics: [
          { time: 0, text: "æ¬¢è¿ä½¿ç”¨éŸ³ä¹æ’­æ”¾å™¨" },
          { time: 10, text: "è¿™æ˜¯ä¸€æ®µç¤ºä¾‹æ­Œè¯" },
          { time: 20, text: "è¯·äº«å—è¿™æ®µæ—‹å¾‹" },
          { time: 30, text: "ğŸµ åŠ¨æ€é¢‘è°±æ­£åœ¨å·¥ä½œ ğŸµ" },
          { time: 40, text: "ç‚¹å‡»è¿›åº¦æ¡å¯è·³è½¬" },
          { time: 50, text: "æ”¯æŒä¸Šä¸€é¦–/ä¸‹ä¸€é¦–" },
          { time: 60, text: "æ„Ÿè°¢æ‚¨çš„è†å¬ï¼" }
        ]
      },
      {
        src: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
        title: 'SoundHelix - Song 2',
        lyrics: [
          { time: 0, text: "ç¬¬äºŒé¦–æ­Œæ›²å¼€å§‹" },
          { time: 15, text: "æ­Œè¯ä¹Ÿä¼šè‡ªåŠ¨æ»šåŠ¨" },
          { time: 30, text: "å½“å‰è¡Œä¼šé«˜äº®æ˜¾ç¤º" }
        ]
      }
    ];

    // ===== DOM å…ƒç´  =====
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const progressBar = document.getElementById('progressBar');
    const progressContainer = document.getElementById('progressContainer');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const lyricsEl = document.getElementById('lyrics');
    const visualizerEl = document.getElementById('visualizer');

    let currentSongIndex = 0;
    let isPlaying = false;

    // ===== åˆå§‹åŒ– =====
    function initPlayer() {
      loadSong(songs[currentSongIndex]);
      createVisualizerBars();
    }

    function loadSong(song) {
      audio.src = song.src;
      document.querySelector('.title').textContent = song.title;
      renderLyrics(song.lyrics);
    }

    function renderLyrics(lyrics) {
      lyricsEl.innerHTML = '';
      lyrics.forEach(line => {
        const div = document.createElement('div');
        div.className = 'lyric-line';
        div.dataset.time = line.time;
        div.textContent = line.text;
        lyricsEl.appendChild(div);
      });
    }

    // ===== æ’­æ”¾æ§åˆ¶ =====
    playBtn.addEventListener('click', () => {
      if (isPlaying) {
        audio.pause();
        playBtn.textContent = 'â–¶ï¸';
      } else {
        audio.play();
        playBtn.textContent = 'â¸ï¸';
      }
      isPlaying = !isPlaying;
    });

    audio.addEventListener('play', () => {
      isPlaying = true;
      playBtn.textContent = 'â¸ï¸';
    });

    audio.addEventListener('pause', () => {
      isPlaying = false;
      playBtn.textContent = 'â–¶ï¸';
    });

    audio.addEventListener('ended', () => {
      nextSong();
    });

    // ===== è¿›åº¦æ¡ =====
    audio.addEventListener('loadedmetadata', () => {
      durationEl.textContent = formatTime(audio.duration);
    });

    audio.addEventListener('timeupdate', () => {
      const percent = (audio.currentTime / audio.duration) * 100;
      progressBar.style.width = `${percent}%`;
      currentTimeEl.textContent = formatTime(audio.currentTime);
      updateLyricsHighlight();
    });

    progressContainer.addEventListener('click', (e) => {
      const width = progressContainer.clientWidth;
      const clickX = e.offsetX;
      const duration = audio.duration;
      audio.currentTime = (clickX / width) * duration;
    });

    // ===== æ­Œè¯é«˜äº® =====
    function updateLyricsHighlight() {
      const currentTime = audio.currentTime;
      const lines = document.querySelectorAll('.lyric-line');
      let activeLine = null;

      lines.forEach(line => {
        const time = parseFloat(line.dataset.time);
        if (currentTime >= time) {
          activeLine = line;
        }
      });

      lines.forEach(line => line.classList.remove('active'));
      if (activeLine) {
        activeLine.classList.add('active');
        // æ»šåŠ¨å±…ä¸­
        const container = document.querySelector('.lyrics-container');
        const offsetTop = activeLine.offsetTop - container.offsetHeight / 2 + activeLine.offsetHeight / 2;
        lyricsEl.style.transform = `translateY(${-offsetTop}px)`;
      }
    }

    // ===== åˆ‡æ­Œ =====
    prevBtn.addEventListener('click', () => {
      currentSongIndex = (currentSongIndex - 1 + songs.length) % songs.length;
      loadSong(songs[currentSongIndex]);
      if (isPlaying) audio.play();
    });

    nextBtn.addEventListener('click', () => {
      nextSong();
    });

    function nextSong() {
      currentSongIndex = (currentSongIndex + 1) % songs.length;
      loadSong(songs[currentSongIndex]);
      if (isPlaying) audio.play();
    }

    // ===== æ—¶é—´æ ¼å¼åŒ– =====
    function formatTime(seconds) {
      const min = Math.floor(seconds / 60);
      const sec = Math.floor(seconds % 60);
      return `${min}:${sec < 10 ? '0' : ''}${sec}`;
    }

    // ===== é¢‘è°±å¯è§†åŒ– =====
    let analyser, dataArray, animationId;

    function createVisualizerBars() {
      visualizerEl.innerHTML = '';
      for (let i = 0; i < 64; i++) {
        const bar = document.createElement('div');
        bar.className = 'visualizer-bar';
        visualizerEl.appendChild(bar);
      }
    }

    async function setupAudioContext() {
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      const audioCtx = new AudioContext();

      // åˆ›å»ºåˆ†æå™¨
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 128;
      const bufferLength = analyser.frequencyBinCount;
      dataArray = new Uint8Array(bufferLength);

      // è¿æ¥éŸ³é¢‘æº
      const source = audioCtx.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(audioCtx.destination);

      animateVisualizer();
    }

    function animateVisualizer() {
      if (!analyser) return;
      animationId = requestAnimationFrame(animateVisualizer);
      analyser.getByteFrequencyData(dataArray);

      const bars = document.querySelectorAll('.visualizer-bar');
      for (let i = 0; i < bars.length; i++) {
        const value = dataArray[i] || 0;
        const percent = value / 256;
        const height = 150 * percent;
        bars[i].style.height = `${height}px`;
      }
    }

    // å½“ç”¨æˆ·é¦–æ¬¡äº¤äº’åå¯åŠ¨ AudioContextï¼ˆæµè§ˆå™¨ç­–ç•¥ï¼‰
    document.body.addEventListener('click', () => {
      if (!analyser) {
        setupAudioContext().catch(console.error);
      }
    }, { once: true });

    // ===== å¯åŠ¨ =====
    initPlayer();
  </script>
</body>
</html>